{% extends 'dashboard/base_dashboard.html' %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-user-edit text-warning"></i> Editar Usuario: {{ usuario.username }}</h2>
        <a href="{% url 'usuarios:listar_usuarios' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Volver al Listado
        </a>
    </div>

    <div class="card shadow">
        <div class="card-body">
            <form method="POST">
                {% csrf_token %}
                
                <div class="mb-3">
                    <label for="{{ form.username.id_for_label }}" class="form-label">Nombre de Usuario</label>
                    {{ form.username }}
                    {% if form.username.errors %}
                        <div class="text-danger">{{ form.username.errors }}</div>
                    {% endif %}
                </div>

                <div class="mb-3">
                    <label for="{{ form.email.id_for_label }}" class="form-label">Email</label>
                    {{ form.email }}
                    {% if form.email.errors %}
                        <div class="text-danger">{{ form.email.errors }}</div>
                    {% endif %}
                </div>

                <div class="mb-3">
                    <label for="{{ form.rol.id_for_label }}" class="form-label">Rol</label>
                    {{ form.rol }}
                    {% if form.rol.errors %}
                        <div class="text-danger">{{ form.rol.errors }}</div>
                    {% endif %}
                </div>

                <div class="mb-3">
                    <label for="{{ form.telefono.id_for_label }}" class="form-label">Teléfono (Formato: +56 9 1234 5678)</label>
                    {{ form.telefono }}
                    {% if form.telefono.errors %}
                        <div class="text-danger">{{ form.telefono.errors }}</div>
                    {% endif %}
                </div>

                <div class="mb-3">
                    <label for="{{ form.is_active.id_for_label }}" class="form-label">Activo</label>
                    <div class="form-check">
                        {{ form.is_active }}
                        <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                            Usuario activo (puede iniciar sesión)
                        </label>
                    </div>
                    {% if form.is_active.errors %}
                        <div class="text-danger">{{ form.is_active.errors }}</div>
                    {% endif %}
                </div>

                <button type="submit" class="btn btn-warning">
                    <i class="fas fa-save"></i> Guardar Cambios
                </button>
            </form>
        </div>
    </div>
</div>

<style>
    input[type="text"], input[type="email"], select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
    }
    .form-check-input {
        width: auto;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const telefonoInput = document.querySelector('input[name="telefono"]');
    
    if (telefonoInput) {
        telefonoInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, ''); // Solo números
            
            // Si empieza con 56, agregar +
            if (value.startsWith('56')) {
                value = value.substring(2);
            }
            
            // Formatear: +56 9 XXXX XXXX
            if (value.length > 0) {
                if (value.length <= 1) {
                    e.target.value = '+56 ' + value;
                } else if (value.length <= 5) {
                    e.target.value = '+56 ' + value.charAt(0) + ' ' + value.substring(1);
                } else {
                    e.target.value = '+56 ' + value.charAt(0) + ' ' + value.substring(1, 5) + ' ' + value.substring(5, 9);
                }
            }
        });
        
        // Prevenir letras
        telefonoInput.addEventListener('keypress', function(e) {
            if (e.key.length === 1 && !/[0-9]/.test(e.key)) {
                e.preventDefault();
            }
        });
    }
});
</script>
{% endblock %}